#include <mach/mt_typedefs.h>

#define FGAUGE_VOLTAGE_FACTOR           2.44 // mV
#define FGAUGE_CURRENT_FACTOR           6.25 // uV/Rsns
#define FGAUGE_CURRENT_OFFSET_FACTOR    1.56 // uV/Rsns
#define FGAUGE_CAR_FACTOR               6.25 // uV/Rsns
#define FGAUGE_RSNS_FACTOR              0.02 // Ohm

//#define COMPASATE_OCV                   80 // mV for evb
#define COMPASATE_OCV                   40 // mV for phone

#define BATTERY_VOLTAGE_MINIMUM         3400
#define BATTERY_VOLTAGE_MAXIMUM         4200

#define BATTERY_CAPACITY_MAXIMUM        1135

#define TEMPERATURE_T0                  110
#define TEMPERATURE_T1                  0
#define TEMPERATURE_T2                  25
#define TEMPERATURE_T3                  50
#define TEMPERATURE_T                   255 // This should be fixed, never change the value

//#define BATT_CAPACITY                   1280
#define BATT_CAPACITY                   1135

#define ENABLE_SW_COULOMB_COUNTER       0 // 1 is enable, 0 is disable
//#define ENABLE_SW_COULOMB_COUNTER       1 // 1 is enable, 0 is disable

//#define FG_CURRENT_OFFSET_DISCHARGING 	31
#define FG_CURRENT_OFFSET_DISCHARGING 	0

#define FG_RESISTANCE 	20

#define FG_METER_RESISTANCE 	0
//#define FG_METER_RESISTANCE 	540 // current meter

//#define MAX_BOOTING_TIME_FGCURRENT	5*6 // 5 seconds, 6 points = 1s
#define MAX_BOOTING_TIME_FGCURRENT	1*10 // 10s

#if defined(CONFIG_POWER_EXT)
//#define OCV_BOARD_COMPESATE	32 //mV 
#define OCV_BOARD_COMPESATE	72 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#else
//#define OCV_BOARD_COMPESATE	0 //mV 
//#define OCV_BOARD_COMPESATE	48 //mV 
//#define OCV_BOARD_COMPESATE	25 //mV 
#define OCV_BOARD_COMPESATE	0 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
//#define R_FG_BOARD_SLOPE	1057 //slope
//#define R_FG_BOARD_SLOPE	1075 //slope
#endif

#define Q_MAX_POS_50	1965
#define Q_MAX_POS_25	1984
#define Q_MAX_POS_0		1946
#define Q_MAX_NEG_10	1873

#define Q_MAX_POS_50_H_CURRENT	1951
#define Q_MAX_POS_25_H_CURRENT	1969
#define Q_MAX_POS_0_H_CURRENT	1913
#define Q_MAX_NEG_10_H_CURRENT	1782

#define R_FG_VALUE 				20 // mOhm, base is 20
#define CURRENT_DETECT_R_FG	100  //10mA

#define OSR_SELECT_7			0

#define CAR_TUNE_VALUE			100 //1.00

/////////////////////////////////////////////////////////////////////
// <DOD, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _BATTERY_PROFILE_STRUC
{
    kal_int32 percentage;
    kal_int32 voltage;
} BATTERY_PROFILE_STRUC, *BATTERY_PROFILE_STRUC_P;

typedef enum
{
    T1_0C,
    T2_25C,
    T3_50C
} PROFILE_TEMPERATURE;

// T0 -10C
BATTERY_PROFILE_STRUC battery_profile_t0[] =
{
	{0  , 4165},
	{2  , 4138},
	{3  , 4116},
	{5  , 4099},
	{6  , 4086},
	{8  , 4073},
	{10 , 4058},
	{11 , 4042},
	{13 , 4027},
	{14 , 4013},
	{16 , 4000},
	{18 , 3989},
	{19 , 3981},
	{21 , 3972},
	{22 , 3963},
	{24 , 3955},
	{26 , 3944},
	{27 , 3936},
	{29 , 3926},
	{30 , 3915},
	{32 , 3904},
	{34 , 3891},
	{35 , 3878},
	{37 , 3867},
	{38 , 3858},
	{40 , 3848},
	{42 , 3840},
	{43 , 3833},  
	{45 , 3828}, 
	{46 , 3823},
	{48 , 3816},
	{50 , 3811},  
	{51 , 3807},
	{53 , 3803},
	{54 , 3801},
	{56 , 3797},
	{58 , 3795},
	{59 , 3791},
	{61 , 3788},
	{62 , 3787},
	{64 , 3784},
	{66 , 3783},
	{67 , 3782},
	{69 , 3781},
	{70 , 3780},
	{72 , 3777},
	{74 , 3773},
	{75 , 3769},
  {77 , 3764},
  {78 , 3758},
  {80 , 3749},
  {81 , 3740},
  {83 , 3730},
  {85 , 3719},
  {86 , 3713},
  {88 , 3708},
  {89 , 3703},
  {91 , 3701},
  {93 , 3698},
  {94 , 3688},
  {96 , 3655},
  {97 , 3587},
  {98 , 3534},
  {99 , 3502},
  {99 , 3479},
  {99 , 3461},
  {100, 3446},
  {100, 3436},
  {100, 3429},
  {100, 3421},
  {100, 3417},
  {100, 3411},
  {100, 3407},
  {100, 3406},
  {100, 3403},
  {100, 3401},
  {100, 3399}
};      
        
// T1 0C
BATTERY_PROFILE_STRUC battery_profile_t1[] =
{
	{0  , 4177},
	{2  , 4157},
	{3  , 4142},
	{5  , 4125},
	{6  , 4111},
	{8  , 4097},
	{9  , 4085},
	{11 , 4073},
	{12 , 4060},
	{14 , 4046},
	{15 , 4031},
	{17 , 4018},
	{18 , 4005},
	{20 , 3994},
	{22 , 3986},
	{23 , 3978},
	{25 , 3968},
	{26 , 3958},
	{28 , 3951},
	{29 , 3941},
	{31 , 3932},
	{32 , 3922},
	{34 , 3912},
	{35 , 3902},
	{37 , 3890},
	{38 , 3876},
	{40 , 3863},
	{42 , 3853},  
	{43 , 3846}, 
	{45 , 3837},
	{46 , 3830},
	{48 , 3824},  
	{49 , 3818},
	{51 , 3813},
	{52 , 3808},
	{54 , 3805},
	{55 , 3800},
	{57 , 3798},
	{58 , 3793},
	{60 , 3791},
	{62 , 3788},
	{63 , 3787},
	{65 , 3784},
	{66 , 3783},
	{68 , 3781},
	{69 , 3780},
	{71 , 3780},
	{72 , 3778},
  {74 , 3776},
  {75 , 3772},
  {77 , 3766},
  {78 , 3761},
  {80 , 3752},
  {82 , 3744},
  {83 , 3733},
  {85 , 3723},
  {86 , 3711},
  {88 , 3704},
  {89 , 3701},
  {91 , 3699},
  {92 , 3697},
  {94 , 3693},
  {95 , 3677},
  {97 , 3623},
  {98 , 3538},
  {100, 3407},
  {100, 3362},
  {100, 3338},
  {100, 3327},
  {100, 3319},
  {100, 3316},
  {100, 3312},
  {100, 3311},
  {100, 3309},
  {100, 3309},
  {100, 3307},
  {100, 3305}
};

// T2 25C
BATTERY_PROFILE_STRUC battery_profile_t2[] =
{
	{0  , 4189},
	{2  , 4171},
	{3  , 4157},
	{5  , 4142},
	{6  , 4127},
	{8  , 4113},
	{9  , 4100},
	{11 , 4086},
	{12 , 4073},
	{14 , 4061},
	{15 , 4049},
	{17 , 4036},
	{18 , 4024},
	{20 , 4013},
	{21 , 4003},
	{23 , 3992},
	{24 , 3980},
	{26 , 3972},
	{27 , 3962},
	{29 , 3952},
	{30 , 3943},
	{32 , 3934},
	{33 , 3926},
	{35 , 3917},
	{36 , 3908},
	{38 , 3900},
	{39 , 3887},
	{41 , 3873},  
	{42 , 3860}, 
	{44 , 3847},
	{45 , 3839},
	{47 , 3832},  
	{48 , 3826},
	{50 , 3820},
	{51 , 3813},
	{53 , 3809},
	{54 , 3804},
	{56 , 3800},
	{57 , 3797},
	{59 , 3793},
	{60 , 3789},
	{62 , 3787},
	{63 , 3784},
	{65 , 3782},
	{66 , 3778},
	{68 , 3777},
	{69 , 3774},
	{71 , 3771},
  {72 , 3767},
  {74 , 3764},
  {75 , 3758},
  {77 , 3753},
  {78 , 3747},
  {80 , 3740},
  {81 , 3734},
  {83 , 3723},
  {84 , 3713},
  {86 , 3701},
  {88 , 3690},
  {89 , 3688},
  {90 , 3686},
  {92 , 3685},
  {93 , 3680},
  {95 , 3668},
  {97 , 3626},
  {98 , 3557},
  {99 , 3454},
  {100, 3292},
  {100, 3268},
  {100, 3261},
  {100, 3257},
  {100, 3257},
  {100, 3256},
  {100, 3256},
  {100, 3256},
  {100, 3254},
  {100, 3253}
}; 

// T3 50C
BATTERY_PROFILE_STRUC battery_profile_t3[] =
{
	{0  , 4189},
	{2  , 4174},
	{3  , 4158},
	{5  , 4144},
	{6  , 4130},
	{8  , 4115},
	{9  , 4100},
	{11 , 4087},
	{12 , 4073},
	{14 , 4060},
	{15 , 4049},
	{17 , 4035},
	{18 , 4023},
	{20 , 4012},
	{21 , 4002},
	{23 , 3991},
	{24 , 3980},
	{26 , 3970},
	{27 , 3959},
	{29 , 3949},
	{30 , 3939},
	{32 , 3932},
	{33 , 3922},
	{35 , 3915},
	{37 , 3905},
	{38 , 3898},
	{40 , 3886},
	{41 , 3872},  
	{43 , 3859}, 
	{44 , 3846},
	{46 , 3838},
	{47 , 3830},  
	{49 , 3824},
	{50 , 3817},
	{52 , 3812},
	{53 , 3808},
	{55 , 3803},
	{56 , 3797},
	{58 , 3794},
	{59 , 3791},
	{61 , 3786},
	{62 , 3784},
	{64 , 3781},
	{65 , 3778},
	{67 , 3774},
	{69 , 3772},
	{70 , 3765},
	{72 , 3755},
  {73 , 3750},
  {75 , 3745},
  {76 , 3739},
  {78 , 3733},
  {79 , 3725},
  {81 , 3721},
  {82 , 3714},
  {84 , 3702},
  {85 , 3692},
  {87 , 3678},
  {88 , 3674},
  {90 , 3672},
  {91 , 3670},
  {93 , 3668},
  {94 , 3662},
  {96 , 3636},
  {97 , 3578},
  {99 , 3491},
  {100, 3357},
  {100, 3266},
  {100, 3260},
  {100, 3257},
  {100, 3256},
  {100, 3254},
  {100, 3254},
  {100, 3254},
  {100, 3253},
  {100, 3253},
  {100, 3253}
};              

// battery profile for actual temperature. The size should be the same as T1, T2 and T3
BATTERY_PROFILE_STRUC battery_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
	  {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
	  {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};    

/////////////////////////////////////////////////////////////////////
// <Rbat, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _R_PROFILE_STRUC
{
    kal_int32 resistance; // Ohm
    kal_int32 voltage;
} R_PROFILE_STRUC, *R_PROFILE_STRUC_P;

// T0 -10C
R_PROFILE_STRUC r_profile_t0[] =
{
	{333    ,  4165},
	{333    ,  4138},
	{360    ,  4116},
	{373    ,  4099},
	{380    ,  4086},
	{383    ,  4073},
	{388    ,  4058},
	{393    ,  4042},
	{398    ,  4027},
	{405    ,  4013},
	{405    ,  4000},
	{410    ,  3989},
	{415    ,  3981},
	{418    ,  3972},
	{420    ,  3963},
	{425    ,  3955},
	{428    ,  3944},
	{433    ,  3936},
	{428    ,  3926},
	{428    ,  3915},
	{428    ,  3904},
	{415    ,  3891},
	{405    ,  3878},
	{398    ,  3867},
	{400    ,  3858},
	{398    ,  3848},
	{390    ,  3840},
	{393    ,  3833},  
	{395    ,  3828}, 
	{398    ,  3823},
	{398    ,  3816},
	{398    ,  3811},  
	{403    ,  3807},
	{408    ,  3803},
	{413    ,  3801},
	{415    ,  3797},
	{420    ,  3795},
	{420    ,  3791},
	{423    ,  3788},
	{425    ,  3787},
	{425    ,  3784},
	{430    ,  3783},
	{438    ,  3782},
	{440    ,  3781},
	{448    ,  3780},
	{445    ,  3777},
	{450    ,  3773},
	{450    ,  3769},
  {455    ,  3764},
  {458    ,  3758},
  {463    ,  3749},
  {465    ,  3740},
  {468    ,  3730},
  {470    ,  3719},
  {475    ,  3713},
  {490    ,  3708},
  {503    ,  3703},
  {530    ,  3701},
  {578    ,  3698},
  {638    ,  3688},
  {700    ,  3655},
  {828    ,  3587},
  {835    ,  3534},
  {760    ,  3502},
  {700    ,  3479},
  {655    ,  3461},
  {620    ,  3446},
  {595    ,  3436},
  {578    ,  3429},
  {563    ,  3421},
  {550    ,  3417},
  {533    ,  3411},
  {523    ,  3407},
  {523    ,  3406},
  {518    ,  3403},
  {505    ,  3401},
  {505    ,  3399}
};

// T1 0C
R_PROFILE_STRUC r_profile_t1[] =
{
	{228    ,  4177},
	{228    ,  4157},
	{238    ,  4142},
	{235    ,  4125},
	{240    ,  4111},
	{243    ,  4097},
	{243    ,  4085},
	{245    ,  4073},
	{248    ,  4060},
	{253    ,  4046},
	{253    ,  4031},
	{258    ,  4018},
	{263    ,  4005},
	{263    ,  3994},
	{270    ,  3986},
	{273    ,  3978},
	{275    ,  3968},
	{275    ,  3958},
	{285    ,  3951},
	{288    ,  3941},
	{285    ,  3932},
	{285    ,  3922},
	{285    ,  3912},
	{285    ,  3902},
	{278    ,  3890},
	{268    ,  3876},
	{255    ,  3863},
	{255    ,  3853},  
	{253    ,  3846}, 
	{250    ,  3837},
	{248    ,  3830},
	{245    ,  3824},  
	{250    ,  3818},
	{250    ,  3813},
	{248    ,  3808},
	{253    ,  3805},
	{255    ,  3800},
	{255    ,  3798},
	{255    ,  3793},
	{260    ,  3791},
	{260    ,  3788},
	{265    ,  3787},
	{263    ,  3784},
	{268    ,  3783},
	{268    ,  3781},
	{273    ,  3780},
	{273    ,  3780},
	{273    ,  3778},
  {275    ,  3776},
  {273    ,  3772},
  {268    ,  3766},
  {270    ,  3761},
  {265    ,  3752},
  {265    ,  3744},
  {265    ,  3733},
  {270    ,  3723},
  {270    ,  3711},
  {268    ,  3704},
  {275    ,  3701},
  {278    ,  3699},
  {293    ,  3697},
  {313    ,  3693},
  {325    ,  3677},
  {328    ,  3623},
  {365    ,  3538},
  {478    ,  3407},
  {408    ,  3362},
  {348    ,  3338},
  {320    ,  3327},
  {298    ,  3319},
  {293    ,  3316},
  {280    ,  3312},
  {280    ,  3311},
  {275    ,  3309},
  {280    ,  3309},
  {280    ,  3307},
  {270    ,  3305}
}; 

// T2 25C
R_PROFILE_STRUC r_profile_t2[] =
{
	{173    ,  4189},
	{138    ,  4171},
	{143    ,  4157},
	{140    ,  4142},
	{143    ,  4127},
	{143    ,  4113},
	{145    ,  4100},
	{145    ,  4086},
	{148    ,  4073},
	{148    ,  4061},
	{153    ,  4049},
	{153    ,  4036},
	{153    ,  4024},
	{155    ,  4013},
	{158    ,  4003},
	{158    ,  3992},
	{153    ,  3980},
	{163    ,  3972},
	{165    ,  3962},
	{165    ,  3952},
	{170    ,  3943},
	{173    ,  3934},
	{173    ,  3926},
	{178    ,  3917},
	{180    ,  3908},
	{183    ,  3900},
	{178    ,  3887},
	{170    ,  3873},  
	{160    ,  3860}, 
	{153    ,  3847},
	{150    ,  3839},
	{148    ,  3832},  
	{150    ,  3826},
	{148    ,  3820},
	{145    ,  3813},
	{150    ,  3809},
	{150    ,  3804},
	{150    ,  3800},
	{155    ,  3797},
	{155    ,  3793},
	{153    ,  3789},
	{158    ,  3787},
	{158    ,  3784},
	{160    ,  3782},
	{158    ,  3778},
	{160    ,  3777},
	{160    ,  3774},
	{158    ,  3771},
  {155    ,  3767},
  {153    ,  3764},
  {148    ,  3758},
  {150    ,  3753},
  {148    ,  3747},
  {150    ,  3740},
  {153    ,  3734},
  {150    ,  3723},
  {145    ,  3713},
  {153    ,  3701},
  {148    ,  3690},
  {148    ,  3688},
  {150    ,  3686},
  {160    ,  3685},
  {158    ,  3680},
  {158    ,  3668},
  {165    ,  3626},
  {178    ,  3557},
  {193    ,  3454},
  {233    ,  3292},
  {170    ,  3268},
  {155    ,  3261},
  {143    ,  3257},
  {143    ,  3257},
  {143    ,  3256},
  {143    ,  3256},
  {143    ,  3256},
  {145    ,  3254},
  {138    ,  3253}
}; 

// T3 50C
R_PROFILE_STRUC r_profile_t3[] =
{
	{170    ,  4189},
	{140    ,  4174},
	{135    ,  4158},
	{145    ,  4144},
	{145    ,  4130},
	{143    ,  4115},
	{140    ,  4100},
	{140    ,  4087},
	{140    ,  4073},
	{138    ,  4060},
	{148    ,  4049},
	{140    ,  4035},
	{140    ,  4023},
	{148    ,  4012},
	{148    ,  4002},
	{150    ,  3991},
	{153    ,  3980},
	{153    ,  3970},
	{150    ,  3959},
	{150    ,  3949},
	{150    ,  3939},
	{160    ,  3932},
	{158    ,  3922},
	{163    ,  3915},
	{163    ,  3905},
	{170    ,  3898},
	{168    ,  3886},
	{160    ,  3872},  
	{158    ,  3859}, 
	{148    ,  3846},
	{148    ,  3838},
	{145    ,  3830},  
	{148    ,  3824},
	{145    ,  3817},
	{145    ,  3812},
	{148    ,  3808},
	{150    ,  3803},
	{143    ,  3797},
	{145    ,  3794},
	{148    ,  3791},
	{148    ,  3786},
	{153    ,  3784},
	{155    ,  3781},
	{155    ,  3778},
	{158    ,  3774},
	{160    ,  3772},
	{153    ,  3765},
	{148    ,  3755},
  {150    ,  3750},
  {150    ,  3745},
  {148    ,  3739},
  {148    ,  3733},
  {140    ,  3725},
  {145    ,  3721},
  {148    ,  3714},
  {140    ,  3702},
  {145    ,  3692},
  {143    ,  3678},
  {145    ,  3674},
  {145    ,  3672},
  {148    ,  3670},
  {150    ,  3668},
  {150    ,  3662},
  {150    ,  3636},
  {158    ,  3578},
  {153    ,  3491},
  {165    ,  3357},
  {168    ,  3266},
  {153    ,  3260},
  {143    ,  3257},
  {143    ,  3256},
  {140    ,  3254},
  {140    ,  3254},
  {138    ,  3254},
  {138    ,  3253},
  {135    ,  3253},
  {138    ,  3253}
}; 

// r-table profile for actual temperature. The size should be the same as T1, T2 and T3
R_PROFILE_STRUC r_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
	  {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
	  {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};     


int fgauge_get_saddles(void);
BATTERY_PROFILE_STRUC_P fgauge_get_profile(kal_uint32 temperature);

int fgauge_get_saddles_r_table(void);
R_PROFILE_STRUC_P fgauge_get_profile_r_table(kal_uint32 temperature);
